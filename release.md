2022-01-18
-----------

- [x] Вчера вечером в поисках новых материалов по ЛИКу нашел 
      [крутые наработки по эмулятору на java](http://www.nedopc.org/forum/viewtopic.php?f=90&t=9475").
- [x] Спасибо Lavr за публикацию исходников.
- [x] Базируясь на них перевел проект с Ant+Applet на Jetty+Maven+JNLP+Applet.
- [x] Запустил на нем ROM Лика и игру Клад (не без глюков).
- [x] Описал [по запуску мануал](https://github.com/codenjoyme/8080-emulator#%D0%B7%D0%B0%D0%BF%D1%83%D1%81%D0%BA-%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F").
- [x] Опубликовал [проект на GitHub](https://github.com/codenjoyme/8080-emulator).
- [x] И поделился [наполеоновскими планами](https://github.com/codenjoyme/8080-emulator#%D0%BF%D0%BB%D0%B0%D0%BD-%D0%B4%D0%B5%D0%B9%D1%81%D1%82%D0%B2%D0%B8%D0%B9).
- [x] [Спасибо всем, кто повлиял на это](https://github.com/codenjoyme/8080-emulator#%D0%B1%D0%BB%D0%B0%D0%B3%D0%BE%D0%B4%D0%B0%D1%80%D0%BD%D0%BE%D1%81%D1%82%D0%B8).


2022-01-21
-----------

Эксперименты с [эмулятором](https://github.com/codenjoyme/8080-emulator/tree/a7b480fd1b963e61a11126813199c8566e1dfb3b) 
  продолжаются. На сегодня он умеет:
- [x] Загружать ROM и RKS из файла (пока что в ручном режиме в сырцах true на 
      false надо сменить).
- [x] При этом можно загружать ПЗУ Лика или Специалиста.
- [x] Игра Клад уже работает без ошибков. Бейсик все еще глючит.
- [x] Появился программный ассемблер/дизассемблер. Он сейчас еще 
      работает не полноценно, т.к. не все команды реализованы (пока что 30% готовности).
- [x] Появились юнит тесты - тестирующие команды процессора.
- [x] Появились интеграционные тесты, тестирующие что будет в результате 
      выполнения 10M тиков на определенной ROM/игре c CPU/экраном (в формате png).
- [x] Постепенно переношу полезные материалы (мануалы, игры) в ресурсы 
      проекта. Этот репозиторий планируется как единое место для всех 
      наработок и контента.
- [x] Код сильно отрефакторен. Удален старый код ZX Spectrum, расширенные 
      команды Z80, фичи, которые пока что не сильно нужны (после переноса 
      на новый модерновый UI фреймворк часть из них верну). Сильно упрощал 
      везде, где только можно. Разделил все GodObjects на компоненты.

2022-01-29
-----------

Обновления в [эмуляторе](https://github.com/codenjoyme/8080-emulator/tree/d05dfe34290c306f6a515c425625b14ce2e54839):
- [x] Все команды мигрированы из старого процедурного стиля в новый OOP.
- [x] Попутно устранены проблемы с флагом P и командой DAA (в этом  
      как оказалось, крылись отличия Z80 и i8080).
- [x] Спасибо [Автору статьи про различия i8080 и Z80](https://webhamster.ru/mytetrashare/index/mtb0/1637215098k115beckd4).
- [x] Спасибо Viktor Pykhonin [за исходники](https://github.com/vpyk/emu80v4/blob/master/src/Cpu8080.cpp) 
      и emu80-дебаггер они очень помогли разобраться в отличиях.
- [x] Спасибо Авторам [тестов команд i8080](https://github.com/begoon/i8080-core) 
      и Begoon за то, что выложил их на своем GitHub вместе с исходниками.
- [x] Спасибо Svofski за чудный [assembler редактор](https://svofski.github.io/pretty-8080-assembler/) 
      благодаря ему я смог адаптировать нерабочие тесты к работе на ЛИКе. Речь про 
      [test.asm](https://github.com/codenjoyme/8080-emulator/blob/d05dfe34290c306f6a515c425625b14ce2e54839/src/main/resources/test/test.asm) 
      и [test.rks](https://github.com/codenjoyme/8080-emulator/blob/d05dfe34290c306f6a515c425625b14ce2e54839/src/main/resources/test/test.rks).
- [x] Итого игра Клад работает до самого последнего призового уровня (раньше 
      не работала), а так же бейсик завелся и предварительно работает.
- [x] Уверен есть еще много косяков связанных с флагами. У меня в очереди 
      жду еще три обширных теста команд i8080. В ближайшем будущем поправим. 
      Тесты [лежат тут](https://github.com/codenjoyme/8080-emulator/tree/d05dfe34290c306f6a515c425625b14ce2e54839/src/main/resources/test).
- [x] Так как разработка ведется через тесты - улучшен фреймворк для написания 
      тестов. Можно ассемблировать-дизассемблировать команды. Можно останаваливать 
      cpu по какому-то указанному в тесте критерию. Можно трейсить 
      выполнение программы. Можно запускать тесты с записанными сценариями 
      нажатых клавиш.
- [x] Исправлена раскладка клавиатуры. Были ошибки.
- [x] Для удобства есть возможность переключаться QWERTY/JCUKENG по 
      переключению раскладки на хостовой машине, или по временно зажатому Ctrl.
- [x] Модификаторы Ctrl, Alt, Shift (и их комбинации) так же обрабатываются - на 
      некоторые клавиши 2, 4, 6, 7 (и другие) с модификаторами "повешаны" 
      дополнительные символы, которые ждешь глядя на современную калавиатуру.
- [x] По хоткеям NUM_PAD(* + -) можно влиять на скорость эмуляции: максимально 
      ускорять, ускорять на 15% и замедлять на 15% соответственно.
- [x] При работе эмулятора в корне создается файлик keys.rec в нем записано 
      когда (тик) какая клавиша была нажата и когда отпущена. Это позволяет 
      записать вручную сценарий, а потом детерминированно его воспроизводить 
      в тестах или как replay.
- [x] По хоткею NUM_PAD(.) можно загружать любой такой replay.
- [x] По хоткею NUM_PAD(/) можно загружать rks/bin/com файлы. При этом эмулятор
      заботливо вобьет в мониторе JXXYY и нажмет Enter.
- [x] Выпилены старые Апплеты, запуск приложения заменен на Swing.
- [x] Добавлены скрипты build/build-client.sh для запуска десктопной версии, 
      и build/build-server.sh чтобы поднять jetty и раздавать это же приложение в сети.
- [x] Добавлены найденные на просторах сети игры ЛИКа и тексты.

2023-09-09
-----------
- [ ] В JNLP формате не работают хоткеи так же как в обычной версии.
- [x] Разделены тесты CpuTest, CpuPerformanceTest, CpuSmokeTest.
- [x] Выделена документация по командам процессора.

2023-09-10
-----------
- [x] Добавлены тесты на команды процессора 8080.
- [x] Добавлен более удобный тестовый метод для тестирования изменений в памяти.
- [x] Добавлен GPT generated dirty класс, который позволяет быстро по отчету о сваленных 
      тестах jUnit (из Intellij Idea) выкусить actual блок и заменить expected 
      по всему исходнику java класса теста. Очень удобно. Давно пора это в IDE добавить 
      как фичу.  

...

2024-12-06
-----------
- [x] (033e1d34) Теперь тест js версии ассемблера генерируют контент для всех тестов процессора. 
- [x] (7009ba58) Теперь тест java версии ассемблера использует тот же контент, что и js версия для всех тестов процессора. 
- [x] (5262f92f) Исправление ошибки в java ассемблере связанной с неправильной обработкой чисел в формате `0b_1111_1111`.
      в методе `resolveNumber`. 
- [x] (cd2a4802) Исправление в js/java версиях ассемблера в области парсинга разных форматов чисел `resolveNumber`.
      Это отступление от оригинальной вресии js ассемблера было необходимо, так как java версия `evalInvoke` не 
      работает с некоторыми форматами чисел, так как это делает js версия. 
- [x] (27b3fae7) Тест ассемблера `AssemblerTest.assemble()` теперь генерирует `mem` файлы тестов процессора 
      из исходников. Все они соответсвуют оригинальным версиям, о чем можно сделать вывод, что ассемблер работает.
- [x] (c51579d2) В `Bites` появился метод `byteArray` позволяющий получить память в виде массива байтов, что  
      используется теперь в асемблере для удобства.  
- [x] (c7d0080a) `Bites` теперь может печатать содержимое памяти в виде таблицы.
- [x] (c7d0080a) Для нового ассемблера добавлена документация по использованию, тест и `Assembler.main()` ззапускатор.
- [x] (ec138614) Обновил в шапке релизы ассемблера.
      Rev.K2: Ported to Java by Oleksandr Baglai
      Rev.K3: Fixed resolveNumber for processing numbers with '_' in them.
              Fixed corner cases with '0b' prefix in combination with 'h' suffix.
- [x] (8818a6d1) Реализован функционал генерации wave файлов на основе нового ассемблера. 
- [x] (8818a6d1) Добавлены тесты на генерацию wave файлов для всех тестов процессора.
- [x] (1914f442) Исправлена частота дискретизации wave чтобы было близко к тому, как оно в оригинале должно звучать.
- [x] (1914f442) Добавлены тесты на генерацию wave файлов для игры `клад`, исправлены wave файлы всех тестов процессора.
- [x] (c072c39e) Так как в играх появляются дополнительные артефакты кроме самой скопилированной версии, 
      было разделение - каждая игра имеет свою папку с файлами.
- [x] (15f2c737) Добавлена в тесте `testLik_generateWave` генерация всех wave файлов для всех игр ЛИКа.
- [x] (ce6bfe72) В `FileAssert` если файл уже существует, и его хеша нет в кеше, то он пересчитывается. Так как 
      не все тесты подчищают за собой перед своим запуском, это позволяет не падать на тестах,

2024-12-07
-----------
- [x] (c77afbdf) Каждый интеграционный тест теперь пишет approvals контент в папку, которая берется из имени теста. 
      Каждый прочерк заменяется на слеш. Сделано для удобства отладки растущего количества тестов.
- [x] (c77afbdf) В `TrackUpdatedMemorу` добавлена возможность отслеживать изменения только тех даных, что реально поменялись, 
      или всех записываемых. 
- [x] (bfad2f98) В прошлых коммитах потерялись другие тесты. Докоммитил. 
- [x] (883a4221) Добавлены тесты для ассемблирования и дизассемблирования (были уже) игры после того как в нее поиграли, 
      с проследующей проверкой как именно изменилась игра (где ее блоки данных в памяти).
- [x] (883a4221) В `TrackUpdatedMemorу` так же скипаются строчки для 16 байтовых блоков, которые не поменялись.   
- [x] (20b019c0) Исправлено расширение файла на `log`, так как `diff` зарезервировано в IDE.
- [x] (6f466ad5) Исправлена информация про изменения в проекте, а так же в бклоге.
- [x] (972082dc) Рефакторинг. Устранено дублирование в `Bites`.
- [x] (7fa9bac0) `PngVideo` работает в любом диапазоне дат, это необходимо для того, чтобы иметь возможность 
      распечатать как бы выглядела любая область памяти, будь она video memory. Эта возможность пригодится 
      в тестах дальше, чтобы быстро визуально понимать - что поменялось.
- [x] (684e580c) Уточнена связь между диапазоном видео памяти и шириной и высотой экрана.
- [x] (25ddecc9) Реализован метод печатающий в png заданной высота Range из памяти - это полезно для отладки.
      При этом пришлось переработать логику отрисовки видеопамяти.
- [x] (c99ef89f) Исправил ошибку с загрузкой игры через диалог загрузки. Из за недавних исправлений в (925298d1)
      появилась ошибка.
- [x] (3e1c25cc) Добавлена информация о том, как работать с клавишами для упраления эмулятором. 
- [x] (8ebfbb6f) Добавлено логгирование разных важных этапов, для удобства отладки. 
- [x] (b352cd13) Добавлена возможность останавливать recording скрипт командой `stop();` или по нажатию `Pause/Break`. 
- [x] (e95ab927) Нажатие на клавишу `NumPad 3` - создает скринотшот в папке `screenshots` с именем содержащим текущую дату.
- [x] (f4a49761) Нажатие на клавишу `NumPad 4` - останавливает воспроизведение/запись replay.
- [x] (91a7ae56) Поиграл еще в игру `Клад` и кажется нашел еще один баг.

2024-12-08
-----------

- [x] (c9ca6d77) Реализовал функциональность сохранения `NumPad 6` и загрузки `NumPad 5` snapshot по хоткеям.
      При этом сохраняются все регистры CPU, IO порты и состояния клавиатуры, а так же вся память.
- [x] (078e2e08) Инкапсулировал логику работы с `Graphic` и `ioDrawMode` в `GraphicControl` внутри `Hardware`.  
- [x] (9144ed04) В загрузку/сохранение snapshot так же включен `ioDrawMode`
- [x] (9abcc545) Полностью переделана загрузка/сохранение snapshot. Теперь каждый объект, который имеет стейт
      должен реализовать `StateProvider` и может быть сохранен в унифицированном подходе - теперь новое свойство
      добавлять просто. 
- [x] (9abcc545) Все данные которые отностятся к подсчету таймингов вынесены из `Application` в `Timings`.
- [x] (9abcc545) Во всех тестах исправлено использование `SmartAssert.setup()`.

2024-12-09
-----------

- [x] (5f05384f) В загрузку/сохранение snapshot так же включен `Cpu.tick`, `Cpu.tact`, `Cpu.interrupt`.
- [x] (a814b732) Выделил из `Application` в `RomSwitcher` логику переключения ROM.
- [x] (3b59136f) В загрузку/сохранение snapshot так же включен `RomSwitcher.lik`.
- [x] (a78bdb27) Рефакторинг в тестовом фреймворке. Больше полезных методов появилось у него из `IntegrationTest`.  
- [x] (16e02921) Добавил тест для декомплияции игры `Клад` и проверки, что она не изменилась после компиляции. 
- [x] (c07e8646) Сделал работу с платформой в ООП стиле.     
- [x] (c07e8646) Выделил в отдельный класс тест для генерации Wave из `rks`, сделал его рабочим для всех платформ.
- [x] (507d0fc4) Улучшена валидация в `StateProvider`.
- [x] (01cb07a2) Новый тест `DizAssemblerTest` теперь пытается генерировать asm файлы для всех игр. 
      Ряд игр не декомпилируются, или компилируются после с ошибками - их мы пока пропустили с TODO.  
- [x] (c6f84cce) Добавил архивы из `https://emu80.org/files/?tags=spmx` для дальнейшей обработки всех полезных артефактов.
- [x] (8d7b70e3) Переработан формат работы с `base`. Теперь за `base` взят корень проекта, а не `src/main/resources`. 
      Пришлось исправить все относительные пути, но зато теперь оно работает в едином стиле. 
- [x] (8d7b70e3) Расширен интерфейс `Platform` теперь он заботится о поиске игры в папке `apps`. 
- [x] (5b694b34) Исправлена ошибка с расширением файла `RKS` то же самое что и `rks`.
- [x] (e7a17f3a) Распаковал все игры и программы, их придется доработать перед тем, как использовать. 
      Формат `rks` отличается от оригинального.  
- [x] (6862f461) Распарсил новый подвид формата `rks`. 
- [x] (dda3b5fa) Нашел оригинальную игру тетрис от Черновицкого Электронмаша из подборки `emu80.org`.

2024-12-10
-----------
 
- [x] (14087daa) Сделал labels такими, что не содержат чисел, а состоят из  4х-буквенных символов, первый из 
      которого `l`, за которым идут три другие из набора `[a-z]`. Лейблы генерятся максимально уникальными. 
      Так чтобы два соседних индекса не были похожими. 
- [x] (5d6701f9) Добавил все GPT запросы, которые использовались, чтобы реализовать несколько последних фич. 
- [x] (df358a87) Несколько тестов исправлено после коммита (14087daa). 
- [x] (6068480a) Улучшил производительность путем исправления логики работы с модами в `Modifiable`. 
      Операция заключенная в модах выполняется для каждого тика, а то и по несколько раз - логика там должна быть 
      молниеносная. 
- [x] (032d06b4) Еще несколько улучшений с целью, которая преследовалась в (6068480a). 
- [x] (a41d2ea8) Пытался улучшить производительность еще, но пока что не получилось. Некоторые улучшения в коде оставил.
- [x] (b0cbe80a) Еще немного оптимизации по памяти. Нет необходиомости записывать для каждого изменения 
      новый `UpdatedBite` - все изменения можно хранить в одном.
- [x] (d8c6ef0d) Нашел описание одногно из тестов на просторах `web archive` и продублировал тут. 
- [x] (f555516e) Добавил еще архив с файлами. Одного только не нашел. 
- [x] (6ed45fd4) Попробовал запустить тест `cputest\cputest.com` но пока не очень получилось. Оставил TODO.  

2024-12-11
-----------
 
- [x] (bfc10dce) Дизассемблировал `Загрузчик` `Лик` в `DizAssemblerTest.testDecompileTest_lik_romZagruzchik`.
- [x] (bfc10dce) Исправлено несколько ошибок в декомплияции ассемберных программ со смещением.  
- [x] (78ca0036) Теперь во всех автогенерируемых `asm` файлах в шапке указано каким декомпилятором оно 
      дизассемблировано и в каком тесте, и где брать исодную версию бинарного файла.    
- [x] (a05e0e3e) Дизассемблировал `Монитор-1М` `Лик` в `DizAssemblerTest.testDecompileTest_lik_romMonitor`.    
- [x] (449706cc) Добавил функциональность, в которой я могу указать какие области памяти при дизассемблировании
      так же стоит рассматривать как вероятные облаасти памяти с кодом. 
- [x] (3e0147d7) Продолжаю уточнять возможные участки кода.   
- [x] (bfe630df) Посортировал все ссылки за пределами программы в порядке возрастания их адресов.    
- [x] (1bc7822d) Лейбл при дизассемблировании генерируется из адреса, а не длинны массива списка существующих лейблов.
      Это по какой-то причине поломало много игрушек. Надо разобраться что не так там. Оставил TODO пока.
- [x] (1bc7822d) Удалил из дизассемблирования команды за пределами области памяти игры.
- [x] (1bc7822d) Исправил форматирование лейблов дизассемблированного кода. 
- [x] (1bc7822d) Ссылки на вшение области памяти в начале программы через `EQU` больше не ссылаются на области внутри  
      программы - это приводило к конфликту, поскольку для этого существуют метки в коде `label:`.    
- [x] (8fb54751) Нашел ошибку. Дело было в методе, который генерил лейблы. 3х сиволов `[a-z]` не достаточно
      для упаковки 16 бит. Надо 4. Но метод еще предстоит поискать. А пока вот GPT поздсказал решение. 
- [x] (f850340c) Поправил алгоритм, и сделал умное размешивание битов, для больше рандомификации. 
- [x] (197e2482) Последний коммит (f850340c) исправил некоторые игрушки.  
- [x] (40cc0d2b) Уточнил еще точку входа в загрузчик Лика.
- [x] (6b6f4043) Уточнил еще точку входа в загрузчик Лика.
- [x] (ea4e618d) Уточнил еще точку входа в монитор Лика.  
- [x] (01981f87) Уточнил еще много точек входа в монитор Лика.
- [x] (01981f87) Реализовал сохранение так же и лога дизассемблирования с адресами памяти и байтами. 
      Так удобнее исследовать закрытые зоны.
- [x] (f855d5ce) Запустил все тесты и прогенерировал логи для всех игр.
- [x] (c071cd5a) Исправил тест монитора. Там не та ПЗУшка грузилась и я сделал дурную работу. 
- [x] (56ef720d) Начал с тестом Бейсика. Но пока только начал... 

2024-12-12
-----------

- [x] (5c97f715) Сделал тест на выполнение команды `B` монитора, и там проверил ПЗУ и адресс `0000...`
  на идентичность. Бейсик копируется и копируется as is. 
- [x] (5c97f715) Порефакторил `Memory` и `Bites` устранил дублирование.
- [x] (e588333e) Реализовал распознавалку экрана. На вход передаешь ей `png` со скриншотом экрана, а она 
      возвращает текст что на нем написано. Есть коллизии с русским/английским текстом, и надо еще хорошо отлаживать. 

2024-12-13
-----------
 
- [x] (793d3bc2) Исправил распознавание png в текст. Инвертированные сиволы тоже распознаются.
- [x] (da1101d3) Реализовал иной метод проверки текстового распознавания экрана.
      Теперь контент по методу `approvals` записывается в ресурсы теста. 
- [x] (28c5711b) Добавил описание про новую функциональность.
- [x] (ca03e46e) Исправил логику определения коллизий в распознавании текста с учетом того, что некоторые 
      символы могут выглядеть одинаково в латинице и кириллице.
- [x] (e4a4fe78) Еще улучшил, чтобы замена была в словах и распостранялось от символа в кириллице влево и вправо.
- [x] (655aa883) Реализовал обратный алгоритм, который позволяет получать `png` изображение экрана печатающего
      заданный текст.
- [x] (fd370b44) Написал тесты на проверку всех символов, что есть в системе.
- [x] (2b929129) Порефакторил внутри `Layout` и `Keyboard` выделил поясняющие константы.
- [x] (5e223429) Добавил знак апострофа и знак пробела. 

2024-12-14
-----------

- [x] (4422e6b5) Переместил часть полей из `IOPorts` в `Keyboard` поскольку хотелось сильнее отвязать `IOPorts` 
      от логики нажатия кнопок. 
- [x] (77c6320c) Несколько реорганизовал код вокруг `Keyboard`. Разюираюсь с тем, как отделить shift нажатый на 
      хостовой машине от shift нажатого в эмулируемой машине.
- [x] (8b1547c6) Разделил шифт на хост машине и шифт на эмулируемой машине - теперь можно передавать shift отжатый
      на эумулируемую машину, при условии что он нажат на хостовой - реньше этого нельзя было сделать. 
- [x] (13ef528c) Небольшой рефакторинг, чтобы все блоки были в одном стиле. Это самый магический код во всем проекте.

2024-12-15
-----------

- [x] (d27a02fe) Сделал полную эмуляцию shift. Теперь нажатия на хостовой машине любых клавиш с любыми модицикаторами 
      связаны с нажатия клавиш на эмулируемой машине только через `Layout` который указывает что реально будет происходить 
      в эмулируемой среде. Пока что не уверен, что работает record логика и все клавиши надо проверить. Но уже получилось 
      избавиться от `alt+shift` костыля.
- [x] (7d1fea7d) Исправил после последних коммитов `Layout` так, чтобы работали нормально символы и буквы с модификаторами.
- [x] (a6e6858f) Еще подправил `Layout` чтобы было похоже на реальную клавиатуру.
- [x] (2e1bf41a) Порефакторил способ, которым отрабатывает `Layout`. Теперь в нем содержится метод, который динамически 
      рассчитывает код клавиши для эмулируемой машины, на основе кода клавиши на хостовой машине и флага `rusLat`, 
      который пока что не имеет никакого влияния.  
- [x] (11530f72) Пересмотрел все клавиши в `Layout`. Много исправил. Остальное в TODO.

2024-12-16
-----------

- [x] (16e0d47a) Во время записи record надо записывать все клавиши, иначе не работает риплей.
- [x] (416753f6) Добавил состояние `cyrLat` и `shiftEmu` в метод сохранения snapshot.
- [x] (--------) Сделал так, чтобы переключение `cyrLat` проводилось 1 раз при нажатии кнопки. Была ошибка.
- [x] (--------) 

Продолжение следует!